<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="http://sequenceiq.com/cloudbreak-docs/configuration/">
        <link rel="shortcut icon" href="../img/favicon.ico">

	<title>Advanced Configuration - Cloudbreak 1.14.4</title>

        <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../css/highlight.css">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation" background="red">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <img class="navbar-logo" src="../img/HWX-RGB-full-no-tagline_500pxh.png" alt="Hortonworks Documentation"
                 width="132" height="52">
            <a class="navbar-brand" href="..">Cloudbreak 1.14.4</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Home <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="..">Introduction</a>
</li>

                        
                            
<li >
    <a href="../architecture/">Architecture</a>
</li>

                        
                            
<li >
    <a href="../onprem/">Installation</a>
</li>

                        
                            
<li >
    <a href="../releasenotes/">Release Notes</a>
</li>

                        
                            
<li >
    <a href="../issues/">Known Issues</a>
</li>

                        
                            
<li >
    <a href="../changelog/">Change Log</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li >
                        <a href="../aws/">AWS</a>
                    </li>
                
                
                
                    <li >
                        <a href="../azure/">Azure</a>
                    </li>
                
                
                
                    <li >
                        <a href="../gcp/">GCP</a>
                    </li>
                
                
                
                    <li >
                        <a href="../openstack/">OpenStack</a>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Reference <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../api/">API</a>
</li>

                        
                            
<li >
    <a href="../shell/">CLI/Shell</a>
</li>

                        
                            
<li >
    <a href="../security/">Cloudbreak Security</a>
</li>

                        
                            
<li >
    <a href="../update/">Update Cloudbreak</a>
</li>

                        
                            
<li >
    <a href="../ui_account/">Account Management</a>
</li>

                        
                            
<li >
    <a href="../periscope/">Auto-Scaling</a>
</li>

                        
                            
<li >
    <a href="../recipes/">Recipes</a>
</li>

                        
                            
<li >
    <a href="../blueprints/">Blueprints</a>
</li>

                        
                            
<li >
    <a href="../images/">Cloud Images (TP)</a>
</li>

                        
                            
<li >
    <a href="../database/">Ambari Database (TP)</a>
</li>

                        
                            
<li >
    <a href="../topologies/">Platforms (TP)</a>
</li>

                        
                            
<li >
    <a href="../kerberos/">Kerberos (TP)</a>
</li>

                        
                            
<li >
    <a href="../ldap/">LDAP/AD (TP)</a>
</li>

                        
                            
<li >
    <a href="../mesos/">Mesos (TP)</a>
</li>

                        
                            
<li >
    <a href="../spi/">SPI</a>
</li>

                        
                            
<li >
    <a href="../operations/">Basic Operations</a>
</li>

                        
                            
<li class="active">
    <a href="./">Advanced Configuration</a>
</li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Development</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../flow/">Flows</a>
</li>

        
    </ul>
  </li>

                        
                        </ul>
                    </li>
                
                
                </ul>
            

            <ul class="nav navbar-nav navbar-right">
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Versions <b class="caret"></b></a>
                    <ul class="dropdown-menu" id="versions-dropdown">
                    </ul>
                </li>
                
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                
                    <li >
                        <a rel="next" href="../operations/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../flow/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                
                
                    <li>
                        <a href="https://github.com/sequenceiq/cloudbreak-docs/blob/master/docs/" >
                            
                                <i class="fa fa-github"></i>
                            
                            GitHub
                        </a>
                    </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#advanced-configuration">Advanced Configuration</a></li>
        
            <li><a href="#environment-specific-profiles">Environment Specific Profiles</a></li>
        
            <li><a href="#available-configurations">Available Configurations</a></li>
        
            <li><a href="#provider-specific-configurations">Provider Specific Configurations</a></li>
        
    
    </ul>
</div></div>
                <div class="col-md-9" role="main">
                    

<h1 id="advanced-configuration">Advanced Configuration</h1>
<p>Cloudbreak Deployer configuration is based on environment variables. Cloudbreak Deployer always opens a new bash subprocess <strong>without inheriting environment variables</strong>. Only the following environment variables <em>are</em> inherited:</p>
<ul>
<li><code>HOME</code></li>
<li><code>DEBUG</code></li>
<li><code>TRACE</code></li>
<li><code>CBD_DEFAULT_PROFILE</code></li>
<li>all <code>DOCKER_XXX</code></li>
</ul>
<p>To set environment variables relevant for Cloudbreak Deployer, add them to a file called <code>Profile</code>.</p>
<p>To see all available environment variables with their default values, run:</p>
<pre><code>cbd env show
</code></pre>

<p>The <code>Profile</code> file is <strong>sourced</strong>, so you can use the usual syntax to set configuration values:</p>
<pre><code>export MY_VAR=some_value
export OTHER_VAR=another_value
</code></pre>

<h2 id="environment-specific-profiles">Environment Specific Profiles</h2>
<p>Letâ€™s say that you want to use a different version of Cloudbreak for <strong>prod</strong> and <strong>qa</strong> profile. Since the <code>Profile</code> file is sourced, you will have to create two environment specific configurations that can be sourced:<br />
- <code>Profile.prod</code><br />
- <code>Profile.qa</code></p>
<p>For example, to create and use a <strong>prod</strong> profile, you need to:</p>
<ol>
<li>Create a file called <code>Profile.prod</code></li>
<li>Write the environment-specific <code>export DOCKER_TAG_CLOUDBREAK=0.3.99</code> into <code>Profile.prod</code> to specify Docker image.</li>
<li>Set the environment variable: <code>CBD_DEFAULT_PROFILE=prod</code></li>
</ol>
<p>To use the <code>prod</code> specific profile once, set:</p>
<pre><code>CBD_DEFAULT_PROFILE=prod cbd some_commands
</code></pre>

<p>To permanently use the  <code>prod</code> profile, set <code>export CBD_DEFAULT_PROFILE=prod</code> in your <code>.bash_profile</code>.</p>
<h2 id="available-configurations">Available Configurations</h2>
<h3 id="using-your-own-ssl-certificate">Using Your Own SSL Certificate</h3>
<p>By default Cloudbreak is available only via HTTPS and it generates its own self-signed certificate. For most use cases such as testing or staging instances this is secure enough. However, if you want to use your own trusted certificate, you must manually configure it on the Cloudbreak host by replacing the existing certificate with your own certificate.</p>
<h4 id="prerequisites">Prerequisites</h4>
<ul>
<li>Resolvable domain name for the Cloudbreak hosts' IP addresses</li>
<li>Generated valid certificate for the domain</li>
</ul>
<h4 id="steps">Steps</h4>
<ol>
<li>First copy your private key and certificate to the host</li>
<li>Log in to the host machine via ssh, usually <code>ssh cloudbreak@[IP-ADDRESS]</code></li>
<li>Make sure the domain name is resolvable for the host: <code>host [HOST-NAME]</code></li>
<li>Change the host name of the machine using steps specific for your operating system</li>
<li>Identify your Cloudbreak location, which usually is <code>/var/lib/cloudbreak-deployer</code> and navigate there</li>
<li>Edit your <code>Profile</code> by adding or replacing <code>PUBLIC_IP</code> with <code>export PUBLIC_IP=[HOST-NAME]</code> where <code>[HOST-NAME]</code> is your actual Cloudbreak host</li>
<li>Configure TLS details in your <code>Profile</code> by adding the following line <code>export CBD_TRAEFIK_TLS="[CERT-LOCATION],[PRIV-KEY-LOCATION]"</code></li>
<li>Restart Cloudbreak using the <code>cbd restart</code> command</li>
</ol>
<h3 id="smtp">SMTP</h3>
<p>If you want to change SMTP parameters, add them your <code>Profile</code>.  </p>
<p>The default values of the SMTP parameters are:</p>
<pre><code>export CLOUDBREAK_SMTP_SENDER_USERNAME=
export CLOUDBREAK_SMTP_SENDER_PASSWORD=
export CLOUDBREAK_SMTP_SENDER_HOST=
export CLOUDBREAK_SMTP_SENDER_PORT=25
export CLOUDBREAK_SMTP_SENDER_FROM=
export CLOUDBREAK_SMTP_AUTH=true
export CLOUDBREAK_SMTP_STARTTLS_ENABLE=true
export CLOUDBREAK_SMTP_TYPE=smtp
</code></pre>

<h4 id="smtps">SMTPS</h4>
<p>If your SMTP server uses SMTPS, you must set the protocol in your <code>Profile</code> to <code>smtps</code>:</p>
<pre><code>export CLOUDBREAK_SMTP_TYPE=smtps
</code></pre>

<h3 id="certificates">Certificates</h3>
<h4 id="trusted-certificates">Trusted Certificates</h4>
<p>If the certificate used by the SMTP server is self-signed or the Java's default trust store doesn't contain it, you can add it to the trust store by copying it to <code>certs/trusted</code> inside the Cloudbreak Deployer directory, and start (or restart) the Cloudbreak container (with <code>cbd start</code>). On startup, the Cloudbreak container  automatically imports the certificates in that directory to its trust store.</p>
<h4 id="cloudbreak-certificate">Cloudbreak Certificate</h4>
<p>If you would like to replace Cloudbreak's self-signed certificate with your own certificate then copy your certificate and the related private key under cloudbreak-deployment directory:</p>
<pre><code>certs/traefik/mydomain.com.crt
certs/traefik/mydomain.com.key
</code></pre>

<p>If the traefik directory does not exsist then create it. After you have coped the cert and private key file, then add the following variable into the Profile file of cbd and restart cbd.</p>
<pre><code>export CBD_TRAEFIK_TLS=&quot;/certs/traefik/mydomain.com.crt,/certs/traefik/mydomain.com.key&quot;
</code></pre>

<p>As a best practice we recommend to replace <code>mydomain.com</code> with the actual domain what you want to use, but make sure that the actual file names and the values in <code>CBD_TRAEFIK_TLS</code> are identical.  </p>
<p><em>Note: password protected private key files can't be used by Cloudbreak</em>  </p>
<h3 id="access-from-custom-domains">Access from Custom Domains</h3>
<p>Cloudbreak Deployer supports multitenancy and uses UAA as an identity provider. In UAA, multitenancy is managed through identity zones. An identity zone is accessed through a unique subdomain. For example, if the standard UAA responds to <a href="https://uaa.10.244.0.34.xip.io">https://uaa.10.244.0.34.xip.io</a>, a zone on this UAA can be accessed through a unique subdomain <a href="https://testzone1.uaa.10.244.0.34.xip.io">https://testzone1.uaa.10.244.0.34.xip.io</a>.</p>
<p>If you want to use a custom domain for your identity or deployment, add the <code>UAA_ZONE_DOMAIN</code> line to your <code>Profile</code>:</p>
<pre><code>export UAA_ZONE_DOMAIN=my-subdomain.example.com
</code></pre>

<p>For example, in our hosted deployment, the <code>identity.sequenceiq.com</code> domain refers to our identity server; therefore, the <code>UAA_ZONE_DOMAIN</code> variable has to be set to that domain. This variable is necessary for UAA to identify which zone provider should handle the requests that arrive to that domain.</p>
<h3 id="consul">Consul</h3>
<p>Cloudbreak uses <a href="http://consul.io">Consul</a> for DNS resolution. All Cloudbreak-related services are registered as <strong>someservice.service.consul</strong>.</p>
<p>Consulâ€™s built-in DNS server is able to fall back on another DNS server.
This option is called <code>-recursor</code>. Clodbreak Deployer first tries to discover the DNS settings of the host by looking for <strong>nameserver</strong> entry in the <code>/etc/resolv.conf</code> file. If it finds one, consul will use it as a recursor. Otherwise, it will use <strong>8.8.8.8</strong> .</p>
<p>For a full list of available consul config options, see Consul <a href="https://consul.io/docs/agent/options.html">documentation</a>.</p>
<p>To pass any additional Consul configuration, define a <code>DOCKER_CONSUL_OPTIONS</code> in the <code>Profile</code> file.</p>
<h3 id="ssh-fingerprint-verification">SSH Fingerprint Verification</h3>
<p>Cloudbreak is able to verify the SSH fingerprints of the provisioned virtual machines. We disable this feature by default for AWS and GCP, because we have experienced issues caused by the fact that Ccoud providers do not always print the SSH fingerprint into the provisioned machines console output. The fingerprint validation feature can be turned on by configuring the <code>CB_AWS_HOSTKEY_VERIFY</code> and/or the <code>CB_GCP_HOSTKEY_VERIFY</code> variables in your <code>Profile</code>. For example:</p>
<pre><code>export CB_AWS_HOSTKEY_VERIFY=true
export CB_GCP_HOSTKEY_VERIFY=true
</code></pre>

<h2 id="provider-specific-configurations">Provider Specific Configurations</h2>
<h3 id="azure-resource-manager-command">Azure Resource Manager Command</h3>
<ul>
<li><strong>cbd azure configure-arm</strong></li>
</ul>
<p>For more information, see Azure <a href="../azure/#azure-application-setup-with-cloudbreak-deployer">documentation</a>.</p>
                    <a href="https://github.com/sequenceiq/cloudbreak-docs/blob/master/docs/configuration.md" ><i class="fa fa-github"></i> Edit on GitHub </a>
                </div>
            
        </div>

        <footer class="col-md-12">
            <hr>
            
            <center>Documentation built with <a href="https://gliderlabs.com/pagebuilder">Pagebuilder</a>.</center>
        </footer>

        <script src="../js/jquery-1.10.2.min.js"></script>
        <script src="../js/bootstrap-3.0.3.min.js"></script>
        <script src="../js/highlight.pack.js"></script>
        <script>var base_url = '..';</script>
        <script data-main="../mkdocs/js/search.js" src="../mkdocs/js/require.js"></script>
        <script src="../js/base.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                    </div>
                    <div class="modal-body">
                        <p>
                            From here you can search these documents. Enter
                            your search terms below.
                        </p>
                        <form role="form">
                            <div class="form-group">
                                <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                            </div>
                        </form>
                        <div id="mkdocs-search-results"></div>
                    </div>
                    <div class="modal-footer">
                    </div>
                </div>
            </div>
        </div>

         <script>
           $( document ).ready(function() {
               $.getJSON("http://sequenceiq.com/cloudbreak-docs/versions.json", function(data) {
               $("#versions-dropdown").append('<li><a href="http://sequenceiq.com/cloudbreak-docs/latest">latest ('+data.latest+')</a></li>');
                $.each(data.versions, function( index, value ) {
                  $("#versions-dropdown").append('<li><a href="http://sequenceiq.com/cloudbreak-docs/'+value+'">'+value+'</a></li>');
                });
               });

               <!--AWS Table-->
               $.getJSON("../providers/aws.json", function(data) {
               $("#cloudbreak-deployer-aws-image-details").append('<br>');
               $("#cloudbreak-deployer-aws-image-details").append('<br>');
               $("#cloudbreak-deployer-aws-image-details").append('<table>');
                 $("#cloudbreak-deployer-aws-image-details").append('<col width="290">');
                 $("#cloudbreak-deployer-aws-image-details").append('<col width="290">');
                 $("#cloudbreak-deployer-aws-image-details").append('<thead>');
                  $("#cloudbreak-deployer-aws-image-details").append('<tr>');
                   $("#cloudbreak-deployer-aws-image-details").append('<th halign="center" style="font-size: 14pt;border:none;border-bottom:solid #DDDDDD 1.5pt;padding:6.0pt 6.0pt 6.0pt 6.0pt">' + "Region" + '</th>');
                   $("#cloudbreak-deployer-aws-image-details").append('<th halign="center" style="font-size: 14pt;border:none;border-bottom:solid #DDDDDD 1.5pt;padding:6.0pt 6.0pt 6.0pt 6.0pt">' + "Image Name" + '</th>');
                  $("#cloudbreak-deployer-aws-image-details").append('</tr>');
                 $("#cloudbreak-deployer-aws-image-details").append('</thead>');
                $("#cloudbreak-deployer-aws-image-details").append('<tbody>');
                 $.each(data.metadata, function( index, value ) {
                 if (index.indexOf("region.") === 0) {
                   shortIndex = index.substring(7)
                  $("#cloudbreak-deployer-aws-image-details").append('<tr>');
                   $("#cloudbreak-deployer-aws-image-details").append('<td halign="center" valign="center" text-align="left" style="font-size: 12pt;border:none;border-bottom:solid #DDDDDD 1.5pt;padding:6.0pt 6.0pt 6.0pt 6.0pt">' + shortIndex + '</td>');
                   $("#cloudbreak-deployer-aws-image-details").append('<td halign="center" valign="center" text-align="right" style="font-size: 12pt;border:none;border-bottom:solid #DDDDDD 1.5pt;padding:6.0pt 6.0pt 6.0pt 6.0pt">' + value + '</td>');
                  $("#cloudbreak-deployer-aws-image-details").append('</tr>');
                  }
                 });
                $("#cloudbreak-deployer-aws-image-details").append('</tbody>');
               $("#cloudbreak-deployer-aws-image-details").append('</table>');
               });

               <!--OpenStack CBD-->
               $.getJSON("../providers/openstack.json", function(data) {
               $("#cloudbreak-deployer-image").append('<br>');
               $("#cloudbreak-deployer-image").append('<br>');
               $("#cloudbreak-deployer-image").append('<p style="font-size: 14px;font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;line-height: 1.428571429;color: #555;">Download the latest Cloudbreak Deployer image to your local machine:</p>');
               $("#cloudbreak-deployer-image").append('<pre><code style="font-size: 12pt;color:#333333">curl -O https://public-repo-1.hortonworks.com/HDP/cloudbreak/' + data.metadata.image_name + '.img</code></pre>');
               $("#cloudbreak-deployer-import").append('<br>');
               $("#cloudbreak-deployer-import").append('<br>');
               $("#cloudbreak-deployer-import").append('<p style="font-size: 14px;font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;line-height: 1.428571429;color: #555;">Set the following environment variables for the OpenStack image import:</p>');
               $("#cloudbreak-deployer-import").append('<pre><code style="font-size: 12px;color:#333333">export CBD_LATEST_IMAGE=</code>' + data.metadata.image_name + '.img</code></p>');
               });

               <!--OpenStack CB-->
               $.getJSON("../providers/openstack_cloudbreak.json", function(data) {
               $("#cloudbreak-image").append('<br>');
               $("#cloudbreak-image").append('<br>');
               $("#cloudbreak-image").append('<p style="font-size: 14px;font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;line-height: 1.428571429;color: #555;">Download the latest Cloudbreak image to your local machine:</p>');
               $("#cloudbreak-image").append('<pre><code style="font-size: 12pt;color:#333333">curl -O https://public-repo-1.hortonworks.com/HDP/cloudbreak/' + data.metadata.image_name + '.img</code></pre>');
               $("#cloudbreak-import").append('<br>');
               $("#cloudbreak-import").append('<br>');
               $("#cloudbreak-import").append('<p style="font-size: 14px;font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;line-height: 1.428571429;color: #555;">This is very similar to the Cloudbreak Deployer. Set the following environment variables for the OpenStack image import:</p>');
               $("#cloudbreak-import").append('<pre><code style="font-size: 12px;color:#333333">export CB_LATEST_IMAGE=</code>' + data.metadata.image_name + '.img</code></p>');
               });

               <!--GCP-->
               $.getJSON("../providers/gcp.json", function(data) {
               $("#cloudbreak-deployer-gcp-image-details").append('<br>');
               $("#cloudbreak-deployer-gcp-image-details").append('<br>');
               $("#cloudbreak-deployer-gcp-image-details").append('<pre><code style="font-size: 12pt;color:#333333"> gcloud compute images create '
                   + data.id + ' --source-uri gs://sequenceiqimage/' + data.id + '.tar.gz' + '</code></pre>');
               });
           });
         </script>
    </body>
</html>
