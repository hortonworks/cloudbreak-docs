<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="http://sequenceiq.com/cloudbreak-docs/configuration/">
        <link rel="shortcut icon" href="../img/favicon.ico">

	<title>Advanced Configuration - Cloudbreak 1.2.3</title>

        <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../css/highlight.css">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation" background="red">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <img class="navbar-logo" src="../img/HWX-RGB-full-no-tagline_500pxh.png" alt="Hortonworks Documentation"
                 width="132" height="52">
            <a class="navbar-brand" href="..">Cloudbreak 1.2.3</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Home <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="..">Introduction</a>
</li>

                        
                            
<li >
    <a href="../architecture/">Architecture</a>
</li>

                        
                            
<li >
    <a href="../onprem/">Installation</a>
</li>

                        
                            
<li >
    <a href="../releasenotes/">Release Notes</a>
</li>

                        
                            
<li >
    <a href="../changelog/">Change Log</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li >
                        <a href="../aws/">AWS</a>
                    </li>
                
                
                
                    <li >
                        <a href="../azure/">Azure</a>
                    </li>
                
                
                
                    <li >
                        <a href="../gcp/">GCP</a>
                    </li>
                
                
                
                    <li >
                        <a href="../openstack/">OpenStack</a>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Reference <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../api/">API</a>
</li>

                        
                            
<li >
    <a href="../shell/">CLI/Shell</a>
</li>

                        
                            
<li >
    <a href="../ui_account/">Account Management</a>
</li>

                        
                            
<li >
    <a href="../periscope/">Auto-Scaling</a>
</li>

                        
                            
<li >
    <a href="../sssd/">SSSD Configuration</a>
</li>

                        
                            
<li >
    <a href="../recipes/">Recipes</a>
</li>

                        
                            
<li >
    <a href="../blueprints/">Blueprints</a>
</li>

                        
                            
<li >
    <a href="../topologies/">Platforms</a>
</li>

                        
                            
<li >
    <a href="../kerberos/">Kerberos</a>
</li>

                        
                            
<li >
    <a href="../mesos/">Mesos</a>
</li>

                        
                            
<li >
    <a href="../spi/">SPI</a>
</li>

                        
                            
<li >
    <a href="../operations/">Operations</a>
</li>

                        
                            
<li >
    <a href="../database/">Migration</a>
</li>

                        
                            
<li class="active">
    <a href="./">Advanced Configuration</a>
</li>

                        
                            
<li >
    <a href="../development/">Development</a>
</li>

                        
                            
<li >
    <a href="../issues/">Known issues</a>
</li>

                        
                        </ul>
                    </li>
                
                
                </ul>
            

            <ul class="nav navbar-nav navbar-right">
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Versions <b class="caret"></b></a>
                    <ul class="dropdown-menu" id="versions-dropdown">
                    </ul>
                </li>
                
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                
                    <li >
                        <a rel="next" href="../database/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../development/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                
                
                    <li>
                        <a href="https://github.com/sequenceiq/cloudbreak-docs/blob/master/docs/" >
                            
                                <i class="fa fa-github"></i>
                            
                            GitHub
                        </a>
                    </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#configuration">Configuration</a></li>
        
            <li><a href="#env-specific-profile">Env specific Profile</a></li>
        
            <li><a href="#available-configurations">Available Configurations</a></li>
        
            <li><a href="#azure-resource-manager-command">Azure Resource manager command</a></li>
        
            <li><a href="#caveats">Caveats</a></li>
        
            <li><a href="#ssh-fingerprint-verification">SSH fingerprint verification</a></li>
        
    
    </ul>
</div></div>
                <div class="col-md-9" role="main">
                    

<h1 id="configuration">Configuration</h1>
<p>Configuration is based on environment variables. Cloudbreak Deployer always forks a new bash subprocess <strong>without
inheriting environment variables</strong>. The only way to set ENV vars relevant for Cloudbreak Deployer is to set them
in a file called <code>Profile</code>.</p>
<p>To see all available config variables with their default value:</p>
<pre><code>cbd env show
</code></pre>

<p>The <code>Profile</code> will be simple <strong>sourced</strong> in bash terms, so you can use the usual syntaxes to set config values:</p>
<pre><code>export MY_VAR=some_value
export OTHER_VAR=dunno
</code></pre>

<h2 id="env-specific-profile">Env specific Profile</h2>
<p>Let’s say you want to use a different version of Cloudbreak for <strong>prod</strong> and <strong>qa</strong> profile.
You can specify the Docker image tag via: <code>DOCKER_TAG_CLOUDBREAK</code>.
<code>Profile</code> is always sourced, so you will have two env specific configurations:
- <code>Profile.dev</code>
- <code>Profile.qa</code></p>
<p>For prod you need:</p>
<ul>
<li>create a file called <code>Profile.prod</code></li>
<li>write the env specific <code>export DOCKER_TAG_CLOUDBREAK=0.3.99</code> into <code>Profile.prod</code></li>
<li>set the env variable: <code>CBD_DEFAULT_PROFILE=prod</code></li>
</ul>
<p>To use the <code>prod</code> specific profile once:</p>
<pre><code>CBD_DEFAULT_PROFILE=prod cbd some_commands
</code></pre>

<p>For permanent setting you can <code>export CBD_DEFAULT_PROFILE=prod</code> in your <code>.bash_profile</code>.</p>
<h2 id="available-configurations">Available Configurations</h2>
<h3 id="smtp">SMTP</h3>
<p>If you want to change SMTP parameters, put the corresponding lines into your <code>Profile</code>. You can also see the default values of the parameters in the following box.</p>
<pre><code>export CLOUDBREAK_SMTP_SENDER_USERNAME=
export CLOUDBREAK_SMTP_SENDER_PASSWORD=
export CLOUDBREAK_SMTP_SENDER_HOST=
export CLOUDBREAK_SMTP_SENDER_PORT=25
export CLOUDBREAK_SMTP_SENDER_FROM=
export CLOUDBREAK_SMTP_AUTH=true
export CLOUDBREAK_SMTP_STARTTLS_ENABLE=true
export CLOUDBREAK_SMTP_TYPE=smtp
</code></pre>

<p><em>Using SMTPS</em></p>
<p>If your SMTP server uses SMTPS you should change the protocol in your Profile:</p>
<pre><code>export CLOUDBREAK_SMTP_TYPE=smtps
</code></pre>

<p>If the certificate used by the SMTP server is self-signed, or Java's default trust store doesn't contain it than you can add it to the trust store by copying it to <code>certs/trusted</code> inside the Cloudbreak deployer directory and start (or restart) the Cloudbreak container (with <code>cbd start</code>).The Cloudbreak container will automatically import the certificates in that directory to its trust store on startup.</p>
<h3 id="access-from-custom-domains">Access from custom domains</h3>
<p>Cloudbreak deployer uses UAA as an identity provider and supports multi tenancy. In UAA terminology this is referred as identity zones. An identity zone is accessed through a unique subdomain. If the standard UAA responds to <a href="https://uaa.10.244.0.34.xip.io">https://uaa.10.244.0.34.xip.io</a> a zone on this UAA would be accessed through <a href="https://testzone1.uaa.10.244.0.34.xip.io">https://testzone1.uaa.10.244.0.34.xip.io</a>.</p>
<p>As an example in our hosted deployment the <code>identity.sequenceiq.com</code> domain refers to our identity server and the <code>UAA_ZONE_DOMAIN</code> variable has to be set to that domain. This variable is necessary for UAA to identify which zone provider should handle the requests that arrives to the given domain.</p>
<p>If you want to use a custom domain for your identity or deployment, put the <code>UAA_ZONE_DOMAIN</code> line into your
<code>Profile</code>. You can see an example in the following box:</p>
<pre><code>export UAA_ZONE_DOMAIN=my-subdomain.example.com
</code></pre>

<h3 id="consul">Consul</h3>
<p><a href="http://consul.io">Consul</a> is used for DNS resolution. All Cloudbreak related services are registered as
<strong>someservice.service.consul</strong>. Consul’s built in DNS server is able to “fall-back” on an other DNS server.
This option is called <code>-recursor</code>. Clodbreak Deployer first tries to discover the DNS settings of the host,
by looking for <strong>nameserver</strong> entry in <code>/etc/resolv.conf</code>. If it finds one consul will use it as a recursor,
otherwise <strong>8.8.8.8</strong> will be used.</p>
<p>For a full list of available consul config options, see the <a href="https://consul.io/docs/agent/options.html">docs</a>.</p>
<p>You can pass any additional consul configuration by defining a <code>DOCKER_CONSUL_OPTIONS</code> in <code>Profile</code>.</p>
<h2 id="azure-resource-manager-command">Azure Resource manager command</h2>
<ul>
<li><strong>cbd azure configure-arm</strong></li>
<li><strong>cbd azure deploy-dash</strong>
See the documentation <a href="../azure/#azure-application-setup-with-cloudbreak-deployer">here</a>.</li>
</ul>
<h2 id="caveats">Caveats</h2>
<p>The <strong>Cloudbreak Deployer</strong> tool opens a clean bash subshell, without inheriting environment variables.</p>
<p>Only the following environment variables <em>are</em> inherited:</p>
<ul>
<li><code>HOME</code></li>
<li><code>DEBUG</code></li>
<li><code>TRACE</code></li>
<li><code>CBD_DEFAULT_PROFILE</code></li>
<li>all <code>DOCKER_XXX</code></li>
</ul>
<h2 id="ssh-fingerprint-verification">SSH fingerprint verification</h2>
<p>Cloudbreak is able to verify the SSH fingerprints of the provisioned virtual machines. We disable this feature by default for AWS and GCP because we have experienced issues, since Cloud providers do not always print the SSH fingerprint into the provisioned machines console output. The fingerprint validation feature could be turned on by configuring the 'CB_AWS_HOSTKEY_VERIFY' and/or the CB_GCP_HOSTKEY_VERIFY variables in your cbd profile like in the following example:</p>
<pre><code>export CB_AWS_HOSTKEY_VERIFY=true
export CB_GCP_HOSTKEY_VERIFY=true
</code></pre>
                    <a href="https://github.com/sequenceiq/cloudbreak-docs/blob/master/docs/configuration.md" ><i class="fa fa-github"></i> Edit on GitHub </a>
                </div>
            
        </div>

        <footer class="col-md-12">
            <hr>
            
            <center>Documentation built with <a href="https://gliderlabs.com/pagebuilder">Pagebuilder</a>.</center>
        </footer>

        <script src="../js/jquery-1.10.2.min.js"></script>
        <script src="../js/bootstrap-3.0.3.min.js"></script>
        <script src="../js/highlight.pack.js"></script>
        <script>var base_url = '..';</script>
        <script data-main="../mkdocs/js/search.js" src="../mkdocs/js/require.js"></script>
        <script src="../js/base.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                    </div>
                    <div class="modal-body">
                        <p>
                            From here you can search these documents. Enter
                            your search terms below.
                        </p>
                        <form role="form">
                            <div class="form-group">
                                <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                            </div>
                        </form>
                        <div id="mkdocs-search-results"></div>
                    </div>
                    <div class="modal-footer">
                    </div>
                </div>
            </div>
        </div>

         <script>
           $( document ).ready(function() {
               $.getJSON("http://sequenceiq.com/cloudbreak-docs/versions.json", function(data) {
               $("#versions-dropdown").append('<li><a href="http://sequenceiq.com/cloudbreak-docs/latest">latest ('+data.latest+')</a></li>');
                $.each(data.versions, function( index, value ) {
                  $("#versions-dropdown").append('<li><a href="http://sequenceiq.com/cloudbreak-docs/'+value+'">'+value+'</a></li>');
                });
               });

               <!--AWS Table-->
               $.getJSON("../providers/aws.json", function(data) {
               $("#cloudbreak-deployer-aws-image-details").append('<br>');
               $("#cloudbreak-deployer-aws-image-details").append('<br>');
               $("#cloudbreak-deployer-aws-image-details").append('<table>');
                 $("#cloudbreak-deployer-aws-image-details").append('<col width="290">');
                 $("#cloudbreak-deployer-aws-image-details").append('<col width="290">');
                 $("#cloudbreak-deployer-aws-image-details").append('<thead>');
                  $("#cloudbreak-deployer-aws-image-details").append('<tr>');
                   $("#cloudbreak-deployer-aws-image-details").append('<th halign="center" style="font-size: 14pt;border:none;border-bottom:solid #DDDDDD 1.5pt;padding:6.0pt 6.0pt 6.0pt 6.0pt">' + "Region" + '</th>');
                   $("#cloudbreak-deployer-aws-image-details").append('<th halign="center" style="font-size: 14pt;border:none;border-bottom:solid #DDDDDD 1.5pt;padding:6.0pt 6.0pt 6.0pt 6.0pt">' + "Image Name" + '</th>');
                  $("#cloudbreak-deployer-aws-image-details").append('</tr>');
                 $("#cloudbreak-deployer-aws-image-details").append('</thead>');
                $("#cloudbreak-deployer-aws-image-details").append('<tbody>');
                 $.each(data.metadata, function( index, value ) {
                 if (index.indexOf("region.") === 0) {
                   shortIndex = index.substring(7)
                  $("#cloudbreak-deployer-aws-image-details").append('<tr>');
                   $("#cloudbreak-deployer-aws-image-details").append('<td halign="center" valign="center" text-align="left" style="font-size: 12pt;border:none;border-bottom:solid #DDDDDD 1.5pt;padding:6.0pt 6.0pt 6.0pt 6.0pt">' + shortIndex + '</td>');
                   $("#cloudbreak-deployer-aws-image-details").append('<td halign="center" valign="center" text-align="right" style="font-size: 12pt;border:none;border-bottom:solid #DDDDDD 1.5pt;padding:6.0pt 6.0pt 6.0pt 6.0pt">' + value + '</td>');
                  $("#cloudbreak-deployer-aws-image-details").append('</tr>');
                  }
                 });
                $("#cloudbreak-deployer-aws-image-details").append('</tbody>');
               $("#cloudbreak-deployer-aws-image-details").append('</table>');
               });

               <!--OpenStack CBD-->
               $.getJSON("../providers/openstack.json", function(data) {
               $("#cloudbreak-deployer-image").append('<br>');
               $("#cloudbreak-deployer-image").append('<br>');
               $("#cloudbreak-deployer-image").append('<p style="font-size: 14px;font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;line-height: 1.428571429;color: #555;">Download the latest Cloudbreak Deployer image to your local machine:</p>');
               $("#cloudbreak-deployer-image").append('<pre><code style="font-size: 12pt;color:#333333">curl -O -k https://public-repo-1.hortonworks.com/HDP/cloudbreak/' + data.id + '</code></pre>');
               $("#cloudbreak-deployer-import").append('<br>');
               $("#cloudbreak-deployer-import").append('<br>');
               $("#cloudbreak-deployer-import").append('<p style="font-size: 14px;font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;line-height: 1.428571429;color: #555;">Set the following environment variables for the OpenStack image import:</p>');
               $("#cloudbreak-deployer-import").append('<pre><code style="font-size: 12px;color:#333333">export CBD_LATEST_IMAGE=</code>' + data.id + '</code></p>');
               });

               <!--OpenStack CB-->
               $.getJSON("../providers/openstack_cloudbreak.json", function(data) {
               $("#cloudbreak-image").append('<br>');
               $("#cloudbreak-image").append('<br>');
               $("#cloudbreak-image").append('<p style="font-size: 14px;font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;line-height: 1.428571429;color: #555;">Download the latest Cloudbreak image to your local machine:</p>');
               $("#cloudbreak-image").append('<pre><code style="font-size: 12pt;color:#333333">curl -O -k https://public-repo-1.hortonworks.com/HDP/cloudbreak/' + data.id + '</code></pre>');
               $("#cloudbreak-import").append('<br>');
               $("#cloudbreak-import").append('<br>');
               $("#cloudbreak-import").append('<p style="font-size: 14px;font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;line-height: 1.428571429;color: #555;">This is very similar to the Cloudbrek Deployer. Set the following environment variables for the OpenStack image import:</p>');
               $("#cloudbreak-import").append('<pre><code style="font-size: 12px;color:#333333">export CB_LATEST_IMAGE=</code>' + data.id + '</code></p>');
               });

               <!--GCP-->
               $.getJSON("../providers/gcp.json", function(data) {
               $("#cloudbreak-deployer-gcp-image-details").append('<br>');
               $("#cloudbreak-deployer-gcp-image-details").append('<br>');
               $("#cloudbreak-deployer-gcp-image-details").append('<pre><code style="font-size: 12pt;color:#333333"> [HACK] gcloud compute images create '
                   + data.id + ' --source-uri gs://sequenceiqimage/' + data.id + '.tar.gz' + '</code></pre>');
               });
           });
         </script>
    </body>
</html>
