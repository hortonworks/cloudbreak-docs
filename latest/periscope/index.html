<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="http://sequenceiq.com/cloudbreak-docs/periscope/">
        <link rel="shortcut icon" href="../img/favicon.ico">

	<title>Auto-Scaling - Cloudbreak 1.3.0</title>

        <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../css/highlight.css">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation" background="red">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <img class="navbar-logo" src="../img/HWX-RGB-full-no-tagline_500pxh.png" alt="Hortonworks Documentation"
                 width="132" height="52">
            <a class="navbar-brand" href="..">Cloudbreak 1.3.0</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Home <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="..">Introduction</a>
</li>

                        
                            
<li >
    <a href="../architecture/">Architecture</a>
</li>

                        
                            
<li >
    <a href="../onprem/">Installation</a>
</li>

                        
                            
<li >
    <a href="../releasenotes/">Release Notes</a>
</li>

                        
                            
<li >
    <a href="../changelog/">Change Log</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li >
                        <a href="../aws/">AWS</a>
                    </li>
                
                
                
                    <li >
                        <a href="../azure/">Azure</a>
                    </li>
                
                
                
                    <li >
                        <a href="../gcp/">GCP</a>
                    </li>
                
                
                
                    <li >
                        <a href="../openstack/">OpenStack</a>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Reference <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../api/">API</a>
</li>

                        
                            
<li >
    <a href="../shell/">CLI/Shell</a>
</li>

                        
                            
<li >
    <a href="../ui_account/">Account Management</a>
</li>

                        
                            
<li class="active">
    <a href="./">Auto-Scaling</a>
</li>

                        
                            
<li >
    <a href="../blueprints/">Blueprints</a>
</li>

                        
                            
<li >
    <a href="../topologies/">Platforms (TP)</a>
</li>

                        
                            
<li >
    <a href="../kerberos/">Kerberos (TP)</a>
</li>

                        
                            
<li >
    <a href="../mesos/">Mesos (TP)</a>
</li>

                        
                            
<li >
    <a href="../spi/">SPI</a>
</li>

                        
                            
<li >
    <a href="../operations/">Operations</a>
</li>

                        
                            
<li >
    <a href="../database/">Migration</a>
</li>

                        
                            
<li >
    <a href="../configuration/">Advanced Configuration</a>
</li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Development</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../environments/">Environments</a>
</li>

        
            
<li >
    <a href="../flow/">Flows</a>
</li>

        
    </ul>
  </li>

                        
                            
<li >
    <a href="../issues/">Known issues</a>
</li>

                        
                        </ul>
                    </li>
                
                
                </ul>
            

            <ul class="nav navbar-nav navbar-right">
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Versions <b class="caret"></b></a>
                    <ul class="dropdown-menu" id="versions-dropdown">
                    </ul>
                </li>
                
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                
                    <li >
                        <a rel="next" href="../ui_account/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../blueprints/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                
                
                    <li>
                        <a href="https://github.com/sequenceiq/cloudbreak-docs/blob/master/docs/" >
                            
                                <i class="fa fa-github"></i>
                            
                            GitHub
                        </a>
                    </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#auto-scaling">Auto-Scaling</a></li>
        
            <li><a href="#how-it-works">How It Works</a></li>
        
            <li><a href="#enable-auto-scaling-via-browser">Enable auto-scaling via Browser</a></li>
        
            <li><a href="#alerts">Alerts</a></li>
        
            <li><a href="#scaling-policies">Scaling Policies</a></li>
        
            <li><a href="#cluster-scaling-configuration">Cluster Scaling Configuration</a></li>
        
    
    </ul>
</div></div>
                <div class="col-md-9" role="main">
                    

<h1 id="auto-scaling">Auto-Scaling</h1>
<p>The purpose of <strong>auto-scaling</strong> is to apply <strong>SLA scaling policies to a Cloudbreak-managed Hadoop cluster</strong>.</p>
<h2 id="how-it-works">How It Works</h2>
<p>The auto-scaling capabilities is based on <a href="https://cwiki.apache.org/confluence/display/AMBARI/Metrics">Ambari Metrics</a> - and <a href="https://cwiki.apache.org/confluence/display/AMBARI/Alerts">Ambari Alerts</a>. Based on the Blueprint
used and the running services, Cloudbreak can access all the available metrics from the subsystem and define <code>alerts</code> based on this information.</p>
<p>Beside the default Ambari Metrics, Cloudbreak includes two custom metrics: <code>Pending YARN containers</code> and <code>Pending applications</code>. These two custom metrics works with the YARN subsystem in order to bring <code>application</code> level QoS to the cluster.</p>
<h2 id="enable-auto-scaling-via-browser">Enable auto-scaling via Browser</h2>
<p><img alt="" src="../images/enable_periscope_v2.png" />
<sub><em>Full size <a href="../images/enable_periscope_v2.png">here</a>.</em></sub></p>
<h2 id="alerts">Alerts</h2>
<p>Auto-scaling supports two <strong>Alert</strong> types: <code>metric</code> and <code>time</code> based.</p>
<p><strong>Metric-based Alerts</strong></p>
<p>Metric based alerts are using the default (or custom) Ambari metrics. These metrics have a default <code>Threshold</code> value 
configured in Ambari - nevertheless these thresholds can be configured, changed or altered in Ambari.</p>
<p>In order to <strong>change default threshold for an Ambari metric</strong> please follow these steps:</p>
<ol>
<li>Go to <strong>Ambari UI</strong> and open the <code>Alerts</code> tab.</li>
<li>Select an alert from the list.</li>
<li>Click on the <code>Edit</code> on the <code>Configuration</code> panel. </li>
<li>You can change the values in the <code>Threshold</code> section.</li>
</ol>
<p><img alt="" src="../images/ambari_threshold_v2.png" />
<sub><em>Full size <a href="../images/ambari_threshold_v2.png">here</a>.</em></sub></p>
<p><strong>Setting up Metric-based Alert</strong></p>
<p>To <strong>create a new Cloudbreak metric based alert</strong> follow these steps:</p>
<ol>
<li>Fill out <code>alert name</code><ul>
<li>Only alphanumeric characters (min 5, max 100 characters) can be applied</li>
</ul>
</li>
<li>Fill out <code>description</code> with a details here about the new alert for the cluster</li>
<li>Select a <code>metric</code> then its <code>desired state</code> <ul>
<li>The Ambari metric based on the installed services and their state based on the Ambari threshold value:<ul>
<li>OK</li>
<li>WARN </li>
<li>CRITICAL </li>
</ul>
</li>
</ul>
</li>
<li>Fill out the time <code>period</code> in minutes to define the metric state endurance after the alert has been triggered<ul>
<li>Only numeric characters can be applied</li>
</ul>
</li>
</ol>
<p><img alt="" src="../images/metric_alert_v2.png" />
<sub><em>Full size <a href="../images/metric_alert_v2.png">here</a>.</em></sub></p>
<p><strong>Time-based Alerts</strong></p>
<p>Time based alerts are based on <code>cron</code> expressions and allow alerts to be triggered based on time.</p>
<p><strong>Setting up Time-based Alert</strong></p>
<p>To <strong>create a new Cloudbreak time based alert</strong> follow these steps:</p>
<ol>
<li>Fill out <code>alert name</code><ul>
<li>Only alphanumeric characters (min 5, max 100 characters) can be applied</li>
</ul>
</li>
<li>Fill out <code>description</code> with a details here about the new alert for the cluster</li>
<li>Select an appropriate <code>time zone</code> for this alert</li>
<li>Fill out the <code>cron expression</code> to define the time-based job scheduler (<em>cron</em> expression) for this alert</li>
</ol>
<p><img alt="" src="../images/time_alert_v2.png" />
<sub><em>Full size <a href="../images/time_alert_v2.png">here</a>.</em></sub></p>
<h2 id="scaling-policies">Scaling Policies</h2>
<p>Scaling is the ability to increase or decrease the capacity of the Hadoop cluster or application based on an alert.
When scaling policies are used, the capacity is automatically increased or decreased according to the conditions defined.
Cloudbreak will do the heavy lifting and based on the alerts and the scaling policy linked to them it executes the 
associated policy. We <strong>scaling granularity is at the <code>host group</code> level - thus you have the option to scale services 
or components only, not the whole cluster</strong>.</p>
<p><strong>Setting up Scaling Policy</strong></p>
<p>To <strong>create a new Cloudbreak scaling policy</strong> follow these steps:</p>
<ol>
<li>Fill out <code>policy name</code><ul>
<li>Only alphanumeric characters (min 5, max 100 characters) can be applied</li>
</ul>
</li>
<li>Select a type first then a value for the <code>scaling adjustment</code>:<ul>
<li><code>node count</code> The number of nodes (added or removed)</li>
<li><code>percentage</code> The computed percentage adjustment based on the cluster size</li>
<li><code>exact</code> The given size of the cluster</li>
</ul>
</li>
<li>Select the Ambari <code>host group</code> where the cluster to be scaled</li>
<li>Select the previously created Cloudbreak <code>alert</code> to apply the scaling policy</li>
</ol>
<p><img alt="" src="../images/policy_v2.png" />
<sub><em>Full size <a href="../images/policy_v2.png">here</a>.</em></sub></p>
<h2 id="cluster-scaling-configuration">Cluster Scaling Configuration</h2>
<p><strong>An SLA scaling policy can contain multiple alerts. When an alert is triggered a <code>scaling adjustment</code> is applied, 
however to keep the cluster size within boundaries a <code>cluster size min.</code> and <code>cluster size max.</code> is attached to the 
cluster</strong> - thus a scaling policy can never over or undersized a cluster.</p>
<p>In order to avoid stressing the cluster we have introduced a <code>cooldown time</code> period (in minutes) - though an alert is
 raised and there is an associated scaling policy. The system will not apply the policy within the configured time 
 frame.</p>
<blockquote>
<p><strong>NOTE</strong> In an SLA scaling policy the triggered rules are applied in order.</p>
</blockquote>
<p><img alt="" src="../images/scaling_config_v2.png" />
<sub><em>Full size <a href="../images/scaling_config_v2.png">here</a>.</em></sub></p>
<p>Explanation of the parameters:</p>
<ul>
<li><code>cooldown time</code> The cluster lockdown period (in minutes) between scaling events</li>
<li><code>cluster size min.</code> the minimum cluster size limit, despite scaling adjustments</li>
<li><code>cluster size max.</code> the maximum cluster size limit, despite scaling adjustments</li>
</ul>
<p><strong>Downscale Scaling Considerations</strong></p>
<p>Cloudbreak auto-scaling will try to keep a healthy cluster, thus does several background checks during <code>downscale</code>.</p>
<ul>
<li><strong>We never remove <code>Application master nodes</code> from a cluster.</strong> In order to make sure that a node running AM is not 
removed, <strong>Cloudbreak has to be able to access the YARN Resource Manager</strong> - when creating a cluster using the 
<code>default</code> secure network template <strong>please make sure that the RM's port is open on the node</strong>.</li>
<li>In order to <strong>keep a healthy HDFS during downscale we always keep the configured <code>replication factor</code> and make sure 
there is enough <code>space</code> on HDFS to rebalance data</strong>.</li>
<li>Also during downscale <strong>in order to minimize the rebalancing, replication and HDFS storms we check block locations 
and compute the less costly operations</strong>.</li>
</ul>
                    <a href="https://github.com/sequenceiq/cloudbreak-docs/blob/master/docs/periscope.md" ><i class="fa fa-github"></i> Edit on GitHub </a>
                </div>
            
        </div>

        <footer class="col-md-12">
            <hr>
            
            <center>Documentation built with <a href="https://gliderlabs.com/pagebuilder">Pagebuilder</a>.</center>
        </footer>

        <script src="../js/jquery-1.10.2.min.js"></script>
        <script src="../js/bootstrap-3.0.3.min.js"></script>
        <script src="../js/highlight.pack.js"></script>
        <script>var base_url = '..';</script>
        <script data-main="../mkdocs/js/search.js" src="../mkdocs/js/require.js"></script>
        <script src="../js/base.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                    </div>
                    <div class="modal-body">
                        <p>
                            From here you can search these documents. Enter
                            your search terms below.
                        </p>
                        <form role="form">
                            <div class="form-group">
                                <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                            </div>
                        </form>
                        <div id="mkdocs-search-results"></div>
                    </div>
                    <div class="modal-footer">
                    </div>
                </div>
            </div>
        </div>

         <script>
           $( document ).ready(function() {
               $.getJSON("http://sequenceiq.com/cloudbreak-docs/versions.json", function(data) {
               $("#versions-dropdown").append('<li><a href="http://sequenceiq.com/cloudbreak-docs/latest">latest ('+data.latest+')</a></li>');
                $.each(data.versions, function( index, value ) {
                  $("#versions-dropdown").append('<li><a href="http://sequenceiq.com/cloudbreak-docs/'+value+'">'+value+'</a></li>');
                });
               });

               <!--AWS Table-->
               $.getJSON("../providers/aws.json", function(data) {
               $("#cloudbreak-deployer-aws-image-details").append('<br>');
               $("#cloudbreak-deployer-aws-image-details").append('<br>');
               $("#cloudbreak-deployer-aws-image-details").append('<table>');
                 $("#cloudbreak-deployer-aws-image-details").append('<col width="290">');
                 $("#cloudbreak-deployer-aws-image-details").append('<col width="290">');
                 $("#cloudbreak-deployer-aws-image-details").append('<thead>');
                  $("#cloudbreak-deployer-aws-image-details").append('<tr>');
                   $("#cloudbreak-deployer-aws-image-details").append('<th halign="center" style="font-size: 14pt;border:none;border-bottom:solid #DDDDDD 1.5pt;padding:6.0pt 6.0pt 6.0pt 6.0pt">' + "Region" + '</th>');
                   $("#cloudbreak-deployer-aws-image-details").append('<th halign="center" style="font-size: 14pt;border:none;border-bottom:solid #DDDDDD 1.5pt;padding:6.0pt 6.0pt 6.0pt 6.0pt">' + "Image Name" + '</th>');
                  $("#cloudbreak-deployer-aws-image-details").append('</tr>');
                 $("#cloudbreak-deployer-aws-image-details").append('</thead>');
                $("#cloudbreak-deployer-aws-image-details").append('<tbody>');
                 $.each(data.metadata, function( index, value ) {
                 if (index.indexOf("region.") === 0) {
                   shortIndex = index.substring(7)
                  $("#cloudbreak-deployer-aws-image-details").append('<tr>');
                   $("#cloudbreak-deployer-aws-image-details").append('<td halign="center" valign="center" text-align="left" style="font-size: 12pt;border:none;border-bottom:solid #DDDDDD 1.5pt;padding:6.0pt 6.0pt 6.0pt 6.0pt">' + shortIndex + '</td>');
                   $("#cloudbreak-deployer-aws-image-details").append('<td halign="center" valign="center" text-align="right" style="font-size: 12pt;border:none;border-bottom:solid #DDDDDD 1.5pt;padding:6.0pt 6.0pt 6.0pt 6.0pt">' + value + '</td>');
                  $("#cloudbreak-deployer-aws-image-details").append('</tr>');
                  }
                 });
                $("#cloudbreak-deployer-aws-image-details").append('</tbody>');
               $("#cloudbreak-deployer-aws-image-details").append('</table>');
               });

               <!--OpenStack CBD-->
               $.getJSON("../providers/openstack.json", function(data) {
               $("#cloudbreak-deployer-image").append('<br>');
               $("#cloudbreak-deployer-image").append('<br>');
               $("#cloudbreak-deployer-image").append('<p style="font-size: 14px;font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;line-height: 1.428571429;color: #555;">Download the latest Cloudbreak Deployer image to your local machine:</p>');
               $("#cloudbreak-deployer-image").append('<pre><code style="font-size: 12pt;color:#333333">curl -O -k https://public-repo-1.hortonworks.com/HDP/cloudbreak/' + data.metadata.image_name + '.img</code></pre>');
               $("#cloudbreak-deployer-import").append('<br>');
               $("#cloudbreak-deployer-import").append('<br>');
               $("#cloudbreak-deployer-import").append('<p style="font-size: 14px;font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;line-height: 1.428571429;color: #555;">Set the following environment variables for the OpenStack image import:</p>');
               $("#cloudbreak-deployer-import").append('<pre><code style="font-size: 12px;color:#333333">export CBD_LATEST_IMAGE=</code>' + data.metadata.image_name + '.img</code></p>');
               });

               <!--OpenStack CB-->
               $.getJSON("../providers/openstack_cloudbreak.json", function(data) {
               $("#cloudbreak-image").append('<br>');
               $("#cloudbreak-image").append('<br>');
               $("#cloudbreak-image").append('<p style="font-size: 14px;font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;line-height: 1.428571429;color: #555;">Download the latest Cloudbreak image to your local machine:</p>');
               $("#cloudbreak-image").append('<pre><code style="font-size: 12pt;color:#333333">curl -O -k https://public-repo-1.hortonworks.com/HDP/cloudbreak/' + data.metadata.image_name + '.img</code></pre>');
               $("#cloudbreak-import").append('<br>');
               $("#cloudbreak-import").append('<br>');
               $("#cloudbreak-import").append('<p style="font-size: 14px;font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;line-height: 1.428571429;color: #555;">This is very similar to the Cloudbrek Deployer. Set the following environment variables for the OpenStack image import:</p>');
               $("#cloudbreak-import").append('<pre><code style="font-size: 12px;color:#333333">export CB_LATEST_IMAGE=</code>' + data.metadata.image_name + '.img</code></p>');
               });

               <!--GCP-->
               $.getJSON("../providers/gcp.json", function(data) {
               $("#cloudbreak-deployer-gcp-image-details").append('<br>');
               $("#cloudbreak-deployer-gcp-image-details").append('<br>');
               $("#cloudbreak-deployer-gcp-image-details").append('<pre><code style="font-size: 12pt;color:#333333"> gcloud compute images create '
                   + data.id + ' --source-uri gs://sequenceiqimage/' + data.id + '.tar.gz' + '</code></pre>');
               });
           });
         </script>
    </body>
</html>
